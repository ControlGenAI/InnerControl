<!DOCTYPE html>
<style>
  .container .hero-body .title.is-3 {
    margin-top: 10px !important;
  }
  .container .hero-body .subtitle {
    margin-bottom: 0 !important;
  }
  strong {
    font-weight: 700;
    color: #333;
  }
</style>

<html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js" integrity="sha384-R2lNHWtz1w8Q1b4Hp0SoQALQU35nOp2zP0WlO2hhVxpu4cr5Zg6H1V6YwD+f+Ch8" crossorigin="anonymous"></script>
<head>
  <meta charset="utf-8" />
  <!-- Meta tags for social media banners, these should be filled in appropriatly as they are your "business card" -->
  <!-- Replace the content tag with appropriate information -->
  <meta name="description"
    content="Heeding the Inner Voice: Aligning ControlNet Training via Intermediate Features Feedback." />

  <meta name="keywords"
    content="Conditional Image Generation, ControlNet, Diffusion models" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>
    InnerControl | Project Page
  </title>
  <link rel="icon" type="image/x-icon" href="static/images/favicon.ico" />
  <link href="https://fonts.googleapis.com/css?family=Google+Sans|Noto+Sans|Castoro" rel="stylesheet" />

  <link rel="stylesheet" href="static/css/bulma.min.css" />
  <link rel="stylesheet" href="static/css/bulma-carousel.min.css" />
  <link rel="stylesheet" href="static/css/bulma-slider.min.css" />
  <link rel="stylesheet" href="static/css/fontawesome.all.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jpswalsh/academicons@1/css/academicons.min.css" />
  <link rel="stylesheet" href="static/css/index.css" />
  <link rel="stylesheet" href="https://unpkg.com/beerslider/dist/BeerSlider.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>
  <script defer src="static/js/fontawesome.all.min.js"></script>
  <script src="static/js/bulma-carousel.min.js"></script>
  <script src="static/js/bulma-slider.min.js"></script>
  <script src="static/js/index.js"></script>
</head>

<body>
  <section class="hero">
    <div class="hero-body">
      <div class="container is-max-desktop">
        <div class="columns is-centered">
          <div class="column has-text-centered">
            <h2 class="title is-2 publication-title">
              Heeding the Inner Voice: Aligning ControlNet Training via Intermediate Features Feedback.
            </h2>
            <div class="is-size-5 publication-authors">
              <!-- Paper authors -->
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=lD5JnEAAAAAJ&hl=ru/">Nina Konovalova</a><sup>1</sup>,</span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=7g8RbyMAAAAJ&hl=ru&oi=ao">Maxim Nikolaev</a><sup>1</sup>,</span>
              <span class="author-block">
                <a href="https://scholar.google.ru/citations?user=q0lIfCEAAAAJ&hl=en" target="_blank" class="">Andrey Kuznetsov</a><sup>1</sup>,
              </span>
              <span class="author-block">
                <a href="https://scholar.google.com/citations?user=MXJTRGoAAAAJ&hl=ru&oi=ao" target="_blank" class="">Aibek Alanov</a><sup>1,2</sup>
              </span>
            </div>
            <!-- a margin of 0.5em -->
            <div style="margin: 0.5em;"></div>
            <div class="is-size-5 publication-authors">
              <span class="author-block is-size-5">
                <span class="author-block"><sup>1</sup> AIRI, Moscow<br>
                <span class="author-block"><sup>2</sup> HSE, University</span><br>
            </div>

            <div class="column has-text-centered">
              <div class="publication-links">
                <!-- Arxiv PDF link -->
                <span class="link-block">
                  <a href="https://arxiv.org/pdf/2410.11236" target="_blank"
                    class="external-link button is-normal is-rounded is-dark">
                    <span class="icon">
                      <i class="fas fa-file-pdf"></i>
                    </span>
                    <span>Paper</span>
                  </a>
                </span>

                <!-- Github link -->
                <span class="link-block">
                  <a href="https://github.com/grenoble-zhang/Ctrl-U" target="_blank"
                    class="external-link button is-normal is-rounded is-dark">
                    <span class="icon">
                      <i class="fab fa-github"></i>
                    </span>
                    <span>Code</span>
                  </a>
                </span>
                  </a>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js" crossorigin="anonymous"></script>


  <section class="hero teaser">
    <div class="container is-max-desktop">
      <div class="hero-body">
        <!-- Image with zero margin at the bottom -->
        <h2 class="title" style="text-align: center;">Motivation</h2>
        <img src="static/images/results.png"
             class="interpolation-image"
             alt="Interpolate start reference image."/>
        <!-- Combined classes in the <h2> tag -->
      </div>
    </div>
    <div class="container is-max-desktop">
      <div class="columns is-centered has-text-centered">
        <div class="column is-four-fifths">
          <!-- Reduced margin for Abstract title -->
          <h2 class="title is-3">Abstract</h2>
          <div class="content has-text-justified">
            <p>
              Despite significant progress in text-to-image diffusion models, achieving precise spatial control over generated outputs remains challenging. One of the popular approaches for this task is ControlNet, which introduces an auxiliary conditioning module into the architecture. To improve alignment of the generated image and control, ControlNet++ proposes a cycle consistency loss to refine correspondence between controls and outputs, but restricts its application to the final denoising steps, while the main structure is introduced at an early generation stage. To address this issue, we suggest <strong>InnerControl</strong> — a training strategy that enforces spatial consistency across all diffusion steps. Specifically, we train lightweight control prediction probes — small convolutional networks — to reconstruct input control signals (e.g., edges, depth) from intermediate UNet features at every denoising step. We prove the efficiency of such models to extract signals even from very noisy latents and utilize these models to generate pseudo ground truth controls during training. The suggested approach enables an alignment loss that minimizes the difference between predicted and target condition throughout the whole diffusion process. Our experiments demonstrate that our method improves control alignment and fidelity of generation. By integrating this loss with established training techniques (e.g., ControlNet++), we achieve high performance across different condition methods such as edge and depth conditions.
            </p>
          </div>
        </div>
    </div>    
    <div style="margin: 2em;"></div>
    <!-- New Motivation Section -->
    <div class="container is-max-desktop">
      <div class="hero-body" style="padding: 10px 0;">
        <h2 class="title is-4" style="margin-bottom: 5px; text-align: center;">Pipeline overview</h2>
        <img src="static/images/pipeline.png"
             class="interpolation-image"
             alt="Interpolate start reference image."/>
        <h2 class="subtitle has-text-justified is-size-6" style=" font-size: 20px;">
          <b>Pipeline overview. We schematically illustrate the main idea of our <strong>InnerControl</strong> framework, highlighting the integration of the alignment loss. The main difference from ControlNet++ is <strong>InnerControl</strong>, which processes intermediate features extracted from the UNet decoder. These features are passed through an aggregation network to predict spatial control signals (e.g., depth or edge maps), which are then compared to the input control $c_{spatial}$ to enforce consistency at every denoising step.
    </div>
    <div style="margin: 2em;"></div>
<div style="margin: 2em;"></div>
  <!-- End youtube video -->
    <div class="hero-body">
      <div class="container">
        <!-- Paper video. -->
        <h2 class="title is-3">Quantitative Results</h2> <!-- Results title, assuming it is left-aligned -->
        <div style="margin: 2em;"></div>
        <div class="container is-max-desktop">
          <div class="hero-body" style="padding: 10px 0;">
            <!-- Center-aligned title for better controllability and generation quality -->
            <h4 class="title is-4" style="margin-bottom: 5px; text-align: center;">Controllability and Generation Quality.</h4>
            <img src="./static/images/metrics.png"
              class="interpolation-image"
              alt="Interpolate start reference image."/>
            <h4 class="subtitle has-text-centered is-size-6">
              <p>
                Unified comparison on the MultiGen‑20M benchmark. 
                Controllability is measured by SSIM (<span style="color:green;">&uarr;</span>) for HED/LineArt and RMSE(<span style="color:red;">&darr;</span>) for Depth; 
                fidelity by FID (<span style="color:red;">&darr;</span>); relevance by CLIP‑score(<span style="color:green;">&uarr;</span>). 
                <sup>*</sup> – denotes training model from scratch using suggested in paper hyperparameters.
              </p>
            </h4>
          </div>
        </div>
  
        <div style="margin: 2em;"></div>
        <!-- Second Qualitative Results aligned with Results -->
        <h2 class="title is-3">Qualitative Results</h2> <!-- Results title, assuming it is left-aligned -->
        <div style="margin: 2em;"></div>
        <div class="container is-max-desktop">
          <div class="hero-body" style="padding: 10px 0;">
            <!-- Center-aligned title for better controllability and generation quality -->
            <h4 class="title is-4" style="margin-bottom: 5px; text-align: center;">Qualitative Comparison with other methods</h4>
            <img src="./static/images/images.pdf"
              class="interpolation-image"
              alt="Interpolate start reference image."/>
              <h4 class="subtitle has-text-justified is-size-6" style="margin-top: 0; font-size: 21px;">
                <b>Visualization of difference between extracted signal from intermediate features and input control after our training applied (<i>top</i>) and for standard ControlNet (<i>bottom</i>)
            </h4>

      </div>
    </div>

    <div style="margin: 2em;"></div>
    <!-- More Visualization Results -->
    <h2 class="title is-3">More Visualization Results</h2>
    <div style="margin: 3.5em;"></div>
    <div class="container is-max-desktop">
      <div class="hero-body">
        <!-- Add buttons above the images -->
        <div class="buttons are-medium is-centered" style="margin-bottom: 20px;">
          <button class="button is-dark" onclick="showImage('depth')">Depth</button>
          <button class="button is-dark" onclick="showImage('lineart')">LineArt</button>
          <button class="button is-dark" onclick="showImage('hed')">HED</button>
        </div>

        <!-- Dynamic image container -->
        <figure>
          <img id="dynamic-image" src="./static/images/depth.pdf" class="interpolation-image" alt="Interpolate start reference image."/>
          <h4 class="title is-4" style="text-align: center;">Selected Control Type</h4>
        </figure>
      </div>
</div>
    </div>

    <div class="container is-max-desktop content" style="font-size: 16px;">
      <h2 class="title is-3">BibTeX</h2>
      If you find our work useful in your research, please consider citing:
      <pre style="font-size: 12px;"><code>@article{zhang2024ctrl,
        title={Ctrl-U: Robust Conditional Image Generation via Uncertainty-aware Reward Modeling},
        author={Zhang, Guiyu and Gao, Huan-ang and Jiang, Zijian and Zhao, Hao and Zheng, Zhedong},
        journal={arXiv preprint arXiv:2410.11236},
        year={2024}
      }</code></pre>
    </div>


    <!--End BibTex citation -->
    
    <footer class="footer">
      <div class="container">
        <div class="columns is-centered">
          <div class="column is-10">
            <div class="content" style="font-size: 12px;"> <!-- Adjusted font size here -->
              <p>
                This page was built using the
                <a href="https://github.com/eliahuhorwitz/Academic-project-page-template" target="_blank">Academic Project
                  Page Template</a> which was adopted from the <a href="https://nerfies.github.io" target="_blank">Nerfies</a> project page.
                You are free to borrow the of this website, we
                just ask that you link back to this page in the footer. <br />
                This website is licensed under a
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank">Creative Commons
                  Attribution-ShareAlike 4.0 International
                  License</a>.
              </p>
            </div>
          </div>
        </div>
      </div>
    </footer>
</section>
  <!-- Statcounter tracking code -->

  <!-- You can add a tracker to track page visits by creating an account at statcounter.com -->

  <!-- End of Statcounter Code -->
  <script src="https://unpkg.com/beerslider/dist/BeerSlider.js"></script>
  <script>
    new BeerSlider(document.getElementById('slider1'), { start: '40' });
    new BeerSlider(document.getElementById('slider2'), { start: '40' });
    new BeerSlider(document.getElementById('slider3'), { start: '40' });
    new BeerSlider(document.getElementById('slider4'), { start: '40' });
    new BeerSlider(document.getElementById('slider5'), { start: '40' });
    new BeerSlider(document.getElementById('slider6'), { start: '40' });
    new BeerSlider(document.getElementById('slider7'), { start: '40' });
    new BeerSlider(document.getElementById('slider8'), { start: '40' });
    new BeerSlider(document.getElementById('slider9'), { start: '40' });
    new BeerSlider(document.getElementById('slider10'), { start: '40' });
  </script>

  <script>
    function showImage(type) {
      const img = document.getElementById('dynamic-image');
      img.src = `./static/images/appendix_${type}.pdf`;
    }
  </script>
</body>

</html>
